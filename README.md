
# thalamus studio: creed (BE data preparation)

To install dependencies

```
# install Bun runtime
curl -fsSL https://bun.sh/install | bash

# install dependencies
bun install

# this command will generate the schema of the database -> write it down in a schema.ts
# export data from nexus and write it down in sqlite database

bun run seed
```


### Start migrate studios from nexus fusion to static portals:

1. provide the sparql view self for the portal in `.env` file. (you can find it in the sparql query in network tab)
2. copy a token from fusion into `.env` file.
3. copy sparql queries per  workspace/dashboard into `nexus.ts`.
    - each object is a workspace
    - each object items are dashboards
    - each object item value is a sparql query.

### Entrypoint (seed.ts file):
The `seed.ts` file will generate the data based on the sparql query, 
which the response format is :

1. head (table columns)
2. results (table results)

the `seed.ts` file will generate the db schema and write it in a file to be managed by drizzle-orm
this is for thalamus studio so the table are generating based on

1. the workspaces (menu in blue)
2. dashboards (per menu item)

for thalamus is missing the videos
the tables should be renamed for different portals


# Thalamus studio: web (Static portal)

```
# install Bun runtime
brew install node@20
node -v # should print `v20.18.0`

# install dependencies
npm install

npm run dev (for testing)

npm run build (to check the output of the build as pages size ...)
```

### portal details (title, description)
1. if the portal has details as title, description, 
    - copy it from the query and past it in the  `markdown/studio-art.md` file.
    the astro framework will take care of rendering the page into html

2. the `layouts/layout.astro` is the main layout of the application 
    - it has the header (can be updated based on loris feedback, logo, ....).

3. copy the `schema.ts` file generated by the `creed` app and rename it under `/api/db.ts`
4. copy the sqlite db (`thalamus.sqlite` in  this case) to the `web` app root folder.


### Entrypoint (`pages/result/[ws]-[type]/index.astro`)

this file will generate all the static files based on the config that you provided

the file will go through all the db tables from `api/db.ts` (schema from the creed app)
and fetch the `columns/data` and return all dashboard as independent pages 

## NOTE
This script saves data to an SQLite database, which can then be uploaded to an S3 bucket. It is primarily used when regenerating static pages due to changes in the data or design updates.


## NOTE
docker image is ready for deployment (works perfectly)